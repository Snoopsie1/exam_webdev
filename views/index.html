% include('_header.html', title='Welcome')

<main class="flex pt-16">
  <div class="w-full h-full">
    <div class="fixed w-[calc(50%-0.5rem)] h-[calc(100%-5rem)] bg-neutral-100">
      <div
        id="map"
        class="w-full h-full rounded-lg"
      ></div>

      <script>
        mapboxgl.accessToken = "{{mapbox_token}}";
        var map = new mapboxgl.Map({
          container: 'map',
          style: 'mapbox://styles/mapbox/streets-v11',
          center: [12.5683, 55.6761],
          zoom: 12
          });

        var properties = "{{properties}}".replace(/&#039;/g, '"');
        properties = JSON.parse(properties);

        var markers = [];

        for (let index = 0; index < properties.length; index++) {
           console.log(properties[index].property_lat);



        var popup = new mapboxgl.Popup({ offset: 25 }).setHTML(
        '<div class="property-card">' +
          '<img src="../images/' +
          properties[index].property_images +
          '" alt="property image" class="w-full aspect-square object-cover rounded-lg">' +
          '<div class="property-info flex flex-col-2">' +
          '<div>' +
          '<h3 class="font-bold">' +
          properties[index].property_name +
          '</h3>' +
          '<p>' +
          properties[index].property_description +
          '</p>' +
          '</div>' +
          '<div class="property-price font-semibold">' +
          properties[index].property_price_pr_night +
          ' DKK' +
          '</div>' +
          '</div>' +
          '</div>'
          );

           var marker = new mapboxgl.Marker().setLngLat([properties[index].property_lat, properties[index].property_lon]).setPopup(popup).addTo(map);

           markers.push(marker)

           console.log("Markers", markers);

        }


        console.log("YOOOOOOOOOOOOOOOOO", properties);
      </script>
    </div>
  </div>
  <div class="w-full pb-16 px-4">
    <div
      id="property"
      class="grid grid-cols-3 gap-3"
    >
      % for property in properties:
      <!--  -->
      % include("_property")
      <!--  -->
      % end
    </div>
    <button
      id="more"
      class="block w-1/3 text-white bg-dragon-fruit mx-auto m-4"
      mix-get="/properties/page/2"
      mix-default="more"
      mix-await="Please wait..."
    >
      Load more
    </button>
  </div>
</main>

% include('_footer.html')
